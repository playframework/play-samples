# Understanding the code

Adding gRPC support to a vanilla Play application requires a few steps:

### 1. `sbt-pekko-grpc`

Add the Pekko gRPC plugin on `project/plugins.sbt`

@@snip [plugins.sbt](../../../../project/plugins.sbt) { #grpc_sbt_plugin }

and enable it on your project (in `build.sbt`):

@@snip [build.sbt](../../../../build.sbt) { #grpc_play_plugins }

The `PekkoGrpcPlugin` locates the gRPC `.proto` files and generates source code from it. Remember to enable the plugin
in all the projects of your build that want to use it.

Note how the `PlayPekkoHttp2Support` is also enabled. gRPC requires HTTP/2 transport and Play supports it only as an opt-in plugin.


### 2.a Serving (Pekko) gRPC Services

Have a look at the `conf/routes` file where you'll notice how to embed a gRPC router within a normal play application.
You can in fact mix normal Play routes with gRPC routers like this to offer a mixed service. You'll notice that we
bind the `/` path to the `controllers.HomeController` like usual route,
and then we use the `->` router binding syntax to bind the `routers.HelloWorldRouter`. This is because gRPC services
have paths correspond to their "methods", yet this is handled by its internal infrastructure and end-users need
not concern themselves about the exact names â€“ clients too are generated from the appropriate
`app/protobuf/helloworld.proto` file after all.

You will need to enable the Pekko-gRPC generators for server-side code:

@@snip [build.sbt](../../../../build.sbt) { #grpc_server_generators }

You can read more about [Service gRPC from a Play App](https://developer.lightbend.com/docs/play-grpc/current/play/serving-grpc.html) in the docs.

### 2.b Injecting Pekko-gRPC Clients

Similarily to the server side, the sources are generated by the Pekko gRPC plugin by having it configured to emit the client as well:

@@snip [build.sbt](../../../../build.sbt) { #grpc_client_generators }

In order to make the gRPC clients easily injectable, we need to enable the following module in Play as well (in this
example app this has been done already though):

@@snip [application.conf](../../../../conf/application.conf) { #grpc_enable_client_module }

Which in turn allows us to inject clients to any of the services defined in our `app/proto` directory, just like so:

@@snip [HomeController.java](../../../../app/controllers/HomeController.java) { #grpc_client_injection }

Since you may want to configure what service discovery or hardcoded location to use for each client, you may do so
as well in `conf/application.conf`, though we will not dive into this here. Refer to the documentation on
[using Pekko Discovery for endpoint discovery](https://pekko.apache.org/docs/pekko-grpc/current/client/configuration.html#using-pekko-discovery-for-endpoint-discovery) for more details.
